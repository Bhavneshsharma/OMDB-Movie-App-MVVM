package com.deepexploit.fiprojectbhavnesh.viewModel

import android.content.Context
import android.util.Log
import android.widget.Toast
import androidx.lifecycle.*
import com.deepexploit.fiprojectbhavnesh.model.ItemModel
import com.deepexploit.fiprojectbhavnesh.repository.OmdbRepository

class MainViewModel(
    private val repository: OmdbRepository,
    search: String,
    page: Int,
    type: String,
) : ViewModel() {

    val showLoader = MutableLiveData<Boolean>()

    val homeSelected = MutableLiveData<Boolean>()
    val movieSelected = MutableLiveData<Boolean>()
    val seriesSelected = MutableLiveData<Boolean>()
    val episodeSelected = MutableLiveData<Boolean>()

    private var isLastPage = false

    private val dataList = mutableListOf<ItemModel>()
    private val _showsLiveData = MutableLiveData<List<ItemModel>?>()
    val showsLiveData = _showsLiveData

    init {
        repository.getData(search, page, type)

        repository.omdbErrorLiveData.observeForever {
            showLoader.value = false
        }

        repository.omdbLiveData.observeForever {
            it?.let { data ->
                val list = data.search ?: listOf()
                dataList.addAll(list)
                _showsLiveData.value = it.search
                isLastPage = (it.totalResults?.toInt() ?: 0) <= dataList.size
            }.run {
                Log.d("Bunty",Unit.toString())
            }
        }
    }

    fun selectHome() {
        episodeSelected.value = false
        seriesSelected.value = false
        movieSelected.value = false
        homeSelected.value = true
    }

    fun selectSeries() {
        episodeSelected.value = false
        seriesSelected.value = true
        movieSelected.value = false
        homeSelected.value = false
    }

    fun selectMovie() {
        episodeSelected.value = false
        seriesSelected.value = true
        movieSelected.value = false
        homeSelected.value = false
    }

    fun selectEpisode() {
        episodeSelected.value = true
        seriesSelected.value = false
        movieSelected.value = false
        homeSelected.value = false
    }

    fun getData(search: String, page: Int, type: String) {
        if (!isLoading() && !isLastPage()) {
            showLoader.value = true
            repository.getData(search, page, type)
        }
    }

    private fun isLastPage(): Boolean {
        return isLastPage
    }

    private fun isLoading(): Boolean {
        return showLoader.value ?: false
    }
}